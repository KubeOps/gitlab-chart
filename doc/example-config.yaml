nginx:
  ingress:
    enabled: true
    hosts:
      - name: registry.example.local
        serviceName: registry
        servicePort: registry
      - name: gitlab.example.local
        serviceName: unicorn
        servicePort: workhorse
  shell:
    name: gitlab-shell
    port: ssh

# Registry sub-chart
registry:
  enabled: true
  registry:
    replicas: 1
    # https://docs.docker.com/registry/deploying/#storage-customization
    storage:
      filesystem:
        rootdirectory: '/var/lib/registry'
      cache:
        blobdescriptor: 'inmemory'
      delete:
        enabled: true
    authEndpoint: 'http://gitlab.example.local'
    tokenIssuer: gitlab-issuer
    certBundle:
      secretName: gitlab-registry
      bundleName: registry-auth.crt

# GitLab sub-chart
gitlab:
    # Unicorn (and workhorse) chart
    unicorn:
      enabled: true
      gitlab_host: gitlab.example.local
      registry:
        host: registry.example.local
        port: 80
        api:
          serviceName: registry
        tokenIssuer: gitlab-issuer
        certificate:
          secret: gitlab-registry
          key: registry-auth.key
      shell:
        secret: gitlab-shell-secret
      gitaly:
        serviceName: gitaly
        auth_token:
          secret: gitaly-secret
          key: token
      redis:
        serviceName: redis
        password:
          secret: gitlab-redis
          key: redis-password
      psql:
        serviceName: omnibus
        password: secure-pgsql-password
    # Sidekiq chart, with split queues (see charts/gitlab/charts/sidekiq/values.yaml)
    sidekiq:
      enabled: true
      concurrency: 10
      timeout: 5
      gitaly:
        serviceName: gitaly
        auth_token:
          secret: gitaly-secret
          key: token
      redis:
        serviceName: redis
        password:
          secret: gitlab-redis
          key: redis-password
      psql:
        serviceName: omnibus
        password: secure-pgsql-password

    gitlab-shell:
      enabled: true
      unicorn:
        serviceName: unicorn
      redis:
        serviceName: redis
        password:
          secret: gitlab-redis
          key: redis-password
    gitaly:
      enabled: true
      secret:
        name: gitaly-secret
        key: token

    migrations:
      enabled: true
      initial_root_password: "minikube"
      redis:
        serviceName: redis
        password:
          secret: gitlab-redis
          key: redis-password
      psql:
        serviceName: omnibus
        password: secure-pgsql-password

    # omnibus sub-chart (development only)
    omnibus:
      enabled: true
      auto_migrate: false
      redis:
        enabled: false
        password:
          secret: gitlab-redis
          key: redis-password
      psql:
        enabled: true
        sql_user_password: ${echo -n '${secure-pgsql-password}gitlab' | md5sum - | cut -d ' ' -f1}
      registry:
        secret: gitlab-registry
        certificate: registry-auth.key
