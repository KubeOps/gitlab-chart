{{- if not (or .Values.global.ingress.configureCertmanager .Values.global.ingress.tls) -}}
WARNING: Automatic TLS certificate generation with cert-manager is disabled and
no TLS certificates were provided. Self-signed certificates were generated.

{{- if (index .Values "gitlab-runner").install -}}
{{- fail "Automatic TLS certificate generation with cert-manager is disabled and no TLS certificates were provided. Self-signed certificates would be generated that do not work with gitlab-runner. Please either disable gitlab-runner by setting `gitlab-runner.install=false` or provide valid certificates." -}}
{{- end -}}

{{- end -}}

{{/* Migration of rails `connection` blocks to secrets */}}
{{- if .Values.unicorn.lfs.connection -}}
{{-   if without (keys .Values.unicorn.lfs.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\nunicorn:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `unicorn.lfs.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.unicorn.artifacts.connection -}}
{{-   if without (keys .Values.unicorn.artifacts.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\nunicorn:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `unicorn.artifacts.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.unicorn.uploads.connection -}}
{{-   if without (keys .Values.unicorn.uploads.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\nunicorn:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `unicorn.uploads.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.sidekiq.lfs.connection -}}
{{-   if without (keys .Values.sidekiq.lfs.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\nsidekiq:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `sidekiq.lfs.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.sidekiq.artifacts.connection -}}
{{-   if without (keys .Values.sidekiq.artifacts.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\nsidekiq:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `sidekiq.artifacts.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.sidekiq.uploads.connection -}}
{{-   if without (keys .Values.sidekiq.uploads.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\nsidekiq:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `sidekiq.uploads.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.task-runner.lfs.connection -}}
{{-   if without (keys .Values.task-runner.lfs.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\ntask-runner:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `task-runner.lfs.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.task-runner.artifacts.connection -}}
{{-   if without (keys .Values.task-runner.artifacts.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\ntask-runner:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `task-runner.artifacts.connection.secret`"
{{-   end -}}
{{- end -}}
{{- if .Values.task-runner.uploads.connection -}}
{{-   if without (keys .Values.task-runner.uploads.connection) "secret" "key" | len | ne 0 -}
{{-     fail "\ntask-runner:\n\tThe `connection` declarations have been moved to be stored in a secret. Please create a secret with these contents, and provide `task-runner.uploads.connection.secret`"
{{-   end -}}
{{- end -}}
